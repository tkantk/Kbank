
<!--/* email-approval.html */-->
<script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function() {
        document.body.style.width = "100%";
        document.body.style.maxWidth = "600px";
        document.body.style.margin = "auto";
        document.body.style.backgroundColor = "white";
        document.body.style.borderCollapse = "collapse";
        var form = document.querySelector('form');
        var approveButton = document.querySelector('.approve-button');
        var declineButton = document.querySelector('.decline-button');
        var feedbackElement = document.createElement('div');
        feedbackElement.style.display = 'none';
        form.appendChild(feedbackElement);

        function showFeedback(message, isError) {
            feedbackElement.textContent = message;
            feedbackElement.style.display = 'block';
            feedbackElement.style.color = isError ? 'red' : 'green';
            setTimeout(function() {
                feedbackElement.style.display = 'none';
            }, 5000);
        }

        function submitForm(action) {
            var formData = new FormData(form);
            formData.set('type', action);

            var xhr = new XMLHttpRequest();
            xhr.open('GET', form.action + '?' + new URLSearchParams(formData).toString(), true);
            xhr.setRequestHeader('Accept', 'application/json');
            xhr.withCredentials = true;

            xhr.onload = function() {
                if (xhr.status >= 200 && xhr.status < 300) {
                    var result = JSON.parse(xhr.responseText);
                    showFeedback('Action ' + action + ' successful: ' + result.message);
                } else {
                    showFeedback('An error occurred while ' + action + 'ing: ' + xhr.statusText, true);
                }
            };

            xhr.onerror = function() {
                showFeedback('An error occurred while ' + action + 'ing', true);
            };

            xhr.send();
        }

        approveButton.addEventListener('click', function(e) {
            e.preventDefault();
            submitForm('approve');
        });

        declineButton.addEventListener('click', function(e) {
            e.preventDefault();
            submitForm('decline');
        });
    });
</script>
<style type="text/css">
    .approve-button {
        background-color: #4CAF50; /* Green */
        color: white;
        border: none;
        padding: 10px 20px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin: 4px 2px;
        cursor: pointer;
        border-radius: 4px;
    }

    .decline-button {
        background-color: #f44336; /* Red */
        color: white;
        border: none;
        padding: 10px 20px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin: 4px 2px;
        cursor: pointer;
        border-radius: 4px;
    }
</style>
<sly data-sly-use.aiDataList="com.kbank.core.models.EmailAprovalModel">
    <table class="container" style="width: 100%; max-width: 600px; margin: auto; background-color: white; padding: 20px; border-collapse: collapse;">
        <tr>
            <td class="header" style="background-color: #55a3c4; padding: 10px; color: white; text-align: center;">
                <h1 style="margin: 0; font-size: 24px;">Market Watch</h1>
                <p style="margin: 0; font-size: 14px;">${aiDataList.currentDate}</p>
            </td>
        </tr>
        <tr>
            <td class="headline" style="background-color: #e0f7fa; padding: 20px; text-align: center;">
                <p style="margin: 0; font-size: 18px; font-weight: bold;">Dear ${aiDataList.name},</p>
                <p style="margin: 10px 0 0 0; font-size: 24px;">Momentum missing ahead of expiry</p>
            </td>
        </tr>
        <tr>
            <td class="headlines" style="background-color: #00a94f; padding: 10px; margin-bottom: 20px; text-align: center;">
                <h2 style="margin: 0; font-size: 20px;">Headlines</h2>
                <table style="width: 100%; margin-bottom: 20px; border-collapse: collapse;">
                        <tr>
                            <sly data-sly-list.item="${aiDataList.listItems}">
                                <sly data-sly-test="${itemList.index >= 0 && itemList.index <= 2}">
                                    <td style="padding: 10px; box-sizing: border-box; border: 1px solid #ccc; margin: 5px; background-color: #e0f7fa;">
                                        <img src="${item.image}" alt="Asia-Pacific markets" style="width: 100%; height: auto; margin-bottom: 10px;">
                                        <h3 style="margin-top: 0; font-size: 16px;">${item.title}</h3>
                                        <p style="font-size: 14px;">${item.description} <a href="${item.uRL}" style="color: #007bff; text-decoration: none;">Read More</a></p>
                                    </td>
                                </sly>
                            </sly>
                        </tr>
                </table>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr>
                        <sly data-sly-list.item="${aiDataList.listItems}">
                            <sly data-sly-test="${itemList.index >= 3 && itemList.index <= 5}">
                                <td style="padding: 10px; box-sizing: border-box; border: 1px solid #ccc; margin: 5px; background-color: #e0f7fa;">
                                    <img src="${item.image}" alt="Asia-Pacific markets" style="width: 100%; height: auto; margin-bottom: 10px;">
                                    <h3 style="margin-top: 0; font-size: 16px;">${item.title}</h3>
                                    <p style="font-size: 14px;">${item.description} <a href="${item.uRL}" style="color: #007bff; text-decoration: none;">Read More</a></p>
                                </td>
                            </sly>
                        </sly>
                    </tr>
                </table>
            </td>
        </tr>
        <tr>
            <td class="views" style="background-color: #fff8dc; padding: 10px; margin-bottom: 20px; text-align: center;">
                <h2 style="margin: 0; font-size: 20px;">Our views for the day</h2>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr>
                        <sly data-sly-list.item="${aiDataList.listItems}">
                            <sly data-sly-test="${itemList.index >= 6 && itemList.index <= 8}">
                                <td style="padding: 10px; box-sizing: border-box; border: 1px solid #ccc; margin: 5px; background-color: #e0f7fa;">
                                    <img src="${item.image}" alt="Asia-Pacific markets" style="width: 100%; height: auto; margin-bottom: 10px;">
                                    <h3 style="margin-top: 0; font-size: 16px;">${item.title}</h3>
                                    <p style="font-size: 14px;">${item.description} <a href="${item.uRL}" style="color: #007bff; text-decoration: none;">Read More</a></p>
                                </td>
                            </sly>
                        </sly>
                    </tr>
                </table>
            </td>
        </tr>
        <tr>
            <td class="footer" style="background-color: #55a3c4; padding: 10px; color: white; text-align: center;">
                <p style="margin: 0; font-size: 14px;">&copy; 2024 Market Watch</p>
            </td>
        </tr>
        <!-- Add form with approve and decline buttons -->
        <tr>
            <!-- Error bar -->
            <div id="errorBar" class="alert error-bar" role="alert"></div>
            <!-- Success bar -->
            <div id="successBar" class="alert success-bar" role="alert"></div>
            <td style="text-align: center; padding: 20px;">
                <form action="/content/kbank/us/en/servlets-content-folder/send-approved-email/jcr:content.json" method="GET">
                    <input type="hidden" name="emailId" value="${aiDataList.email}">
                    <button onclick="submitForm('approve')" type="submit" name="type" value="approve" class="approve-button">Approve</button>
                    <button onclick="submitForm('decline')" type="submit" name="type" value="decline" class="decline-button">Decline</button>
                </form>
            </td>
        </tr>
    </table>
</sly>
